quinta-feira, 7 de março de 2019Há algum tempo o nosso querido Ubuntu Server mudou consideravelmente a sua forma de configuração de rede padrão, se antigamente nós configurávamos as nossas placas de rede em /etc/network/interfaces, à partir do Ubuntu 18.04 LTS (Server ou não) as configurações de rede devem ser feitas através do "netplan". Aprenda a fazer essa configuração.Para configurar a rede no Ubuntu Server, atualmente, você deve navegar até o diretório /etc/netplan, onde será possível encontrar um arquivo com a extensão .yaml, é nele que você deve fazer os seus ajustes.Entendendo a formatação e configuração do arquivo .yaml de redeEu sei, "old habits die hard", mas o novo formato permite um único tipo de configuração de rede em todas as versões do Ubuntu disponíveis, do seu desktop até a "internet das coisas", e bom, mesmo que você não goste muito da ideia de mudar, francamente, não há muito que você possa fazer nesse sentido, porém, a configuração atual é, na verdade, extremamente simples.Dica: Para editar estes arquivos eu vou usar o editor de textos "nano", no meu caso a sintasse para abrir o arquivo de configuração seria:sudo nano /etc/netplan/50-cloud-init.yamlVerifique qual o nome do seu arquivo de configuração de rede com:ls /etc/netplan/Esta é a imagem de um arquivo de configuração de um dos meus servidores:O arquivo por si só já é identado, então, recomendo tomar esse cuidado na organização, isso vai fazer com que seja realmente simples de entender tudo.Indicado com a seta, você tem o nome (ID) da sua placa de rede.Logo abaixo você tem:- Endereço do IP que você quer para a máquina, seguido de uma máscara de sub-rede, declarada nesse caso com um simples "/24" (255.255.255.0);- dhcp4 para IPV4, suportando "verdeiro" ou "falso" para DHCP ativo ou não, com as palavras em Inglês "true" e "false", asssim como o gateway, caso você vá utilizar IPV6, ele deve ser declarado como "dhcp6";- "optional" define se essa placa de rede deve ser aguardada (false) ou não (true) na hora do boot para iniciar o sistema;- Por último você deve configurar o seu DNS sob "nameservers". Observe a identação, você pode adicionar mais de um DNS na mesma linha, apenas separando-os por vírgula, é bem simples de entender observando o exemplo acima.Observe, na imagem acima também, como é feita a organização das informações para que tudo saia corretamente. Antes de fazer qualquer alteração nesse arquivo, você pode, é claro, fazer um backup dele.Configurando DHCP no arquivo de NetplanA configuração de rede do Ubuntu Server pode ser feita no momento da instalação, se você marcar para ele usar DHCP ou ignorar a configuração de rede, esse será o comportamento padrão do sistema, porém, caso você tenha alterado alguma configuração ou queira fazer algum tipo de teste, o DHCP padrão do Ubuntu Server se configura dessa forma:E claro, você pode mesclar as coisas e adicionar configurações extras, como usar um DNS específico.Dica: Como descobrir o ID da minha placa de rede?Como você deve ter percedido, é necessário declarar a sua placa de rede para então fazer as configurações adequadas. Geralmente o próprio Ubuntu adincionará essa identidade ao arquivo por padrão se as placas estiverem no servidor na hora da instalação, mas em caso de dúvida, use o comando:ip addressMesmo sem internet no computador você verá um resultado semelhante a esse, observe o local onde a placa de rede é exibida:Se precisar estudar mais o netplan para fazer configurações menos comuns, basta consultar o manual:Testando e aplicando o "seu plano de rede"O "Netplan" possui alguns recursos interessantes, como uma ferramenta para testar se a configuração está funcional, antes de você aplicar mudanças:sudo netplan tryDessa forma o "Netplan" tentará implementar a suas modificações no sistema, caso algo dê errado, ele vai te avisar. Nesse caso, eu escrevi a palavra "true" errado propositalmente para mostrar o resultado, veja:Ajustando esse erro e repetindo o teste:Repare que agora o meu arquivo de configuração foi aprovado como "funcional", eu posso aplicar a modificação ao sistema simplesmente pressionando "enter" novamente, caso contrário, em 2 minutos o arquivo será revertido ao padrão anterior.Caso você já saiba fazer as modificações e simplesmente queira aplicar direto as suas configurações, basta rodar:sudo netplan applyComo você pode ver, especialmente se você era um dos que constumava fazer ajustes em /etc/network/interfaces, aqui não é necessario reiniciar nenhum serviço ou mesmo o servidor. No entanto, vale a pena observar que caso você edite o seu arquivo (com o nano por exemplo), o salve, e depois reinicie o seu computador, ele vai usá-lo como "netplan" sem a necessidade do "apply".Uma forma nova de configurar o seu Ubuntu ServerApesar de eu ter tratado isso como algo novo, esse método já está disponível para as pessoas que vão usar o Ubuntu Server há praticamente um ano e não é necessariamente mais difícil do que o modo antigo, é apenas diferente. De fato, tirando o nome meio esquisito que o seu "yaml" pode ter, o resto é simples até demais.Espero que o artigo tenha ajudado, se ele lhe foi útil, não esqueça de compartilhar, até a próxima!